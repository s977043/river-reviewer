# Issue案: おみくじ結果の3点セット化 + 7運勢化 + シェア対応（3要素）

## タイトル案

Epic: おみくじ結果の3点セット化 + 7運勢化 + 一言拡充 + シェア対応（3要素）

## ラベル案

- type:feature
- P1
- （任意）m2-dx または m3-smart

## 背景

現状の「結果シェア」が、運勢名・一言・画像のうち一部しか含められない／データが分散していて拡張しづらい。結果を「画像 / 運勢名 / 一言」の 3 点セットとして統一し、シェア時にも 3 つが必ず含まれる状態にしたい。

## ゴール

- 運勢は 7 種類（大吉 / 中吉 / 小吉 / 吉 / 末吉 / 凶 / 大凶）
- 各運勢に一言 5 種類を用意し、表示時にランダム選択
- 結果は 3 点セット（画像・運勢名・一言）のオブジェクトで一貫管理
- シェア時に必ず 3 点セットを共有できる
- 推奨：「画像 + 運勢名 + 一言」を 1 枚のシェア画像に合成して共有
- 代替：OS の制約がある場合は「画像ファイル共有 + テキスト（運勢名 + 一言）」を併用、またはテキストのみフォールバック

## 非ゴール

- 多言語対応
- 履歴・統計・アカウント連携
- おみくじの詳細カテゴリ（願望/恋愛/仕事…）の追加

## ユーザーストーリー

- ユーザーとして、結果をシェアしたときに画像・運勢名・一言がセットで伝わってほしい
- 開発者として、運勢や一言の追加・出現率調整をデータ編集だけで行いたい
- 開発者として、シェア実装が OS 差異に引きずられず安定して動いてほしい

## 実装タスク（案）

### A. データ定義（3点セット統一）

- OmikujiResult（例: id / fortuneText / image / hitokoto / weight）を定義
- 7 運勢を定義
- 各運勢に一言 5 つ（計 35）を定義
- 画像を静的 `require()` 参照で管理

### B. 抽選ロジック

- 重み付き抽選を実装（運勢単位 or セット単位）
- 運勢決定後に、該当運勢の一言 5 つからランダム選択
- 画面側が `result.fortuneText` / `result.hitokoto` / `result.image` だけ見れば済む状態にする

### C. UI 置換

- 結果表示を 3 点セット参照に統一
- シェアボタン導線（既存があれば置換、なければ追加）

### D. シェア機能（今回の追加要件）

推奨実装：シェア用の合成画像を生成し、それを共有する。

- シェア用レンダー（「運勢画像 + 運勢名 + 一言」を 1 枚に合成）を実装
- 表示と同じレイアウト or シェア専用テンプレ（余白・改行・長文折返し）
- 端末解像度に依存しにくいサイズ設計（例: 正方形 or 1080x1920 等）
- 生成した画像を一時ファイルとして保存し、共有シートを開く
- 共有失敗時のフォールバック
- テキストのみ共有（運勢名 + 一言 + アプリ名/ハッシュタグ等）
- 画像共有のみ、など端末に合わせて安全に落とす
- 共有後の一時ファイル掃除（溜めない）

代替実装：画像ファイル + テキストを同時共有（OS 依存が強め）。

- iOS/Android で「画像 + テキスト同時共有」が成立するか検証し、難しければ合成画像方式に統一

### E. テスト / 確認

- 7 運勢が出る（大凶含む）
- 各運勢で一言が 5 種から出る
- シェアで「画像・運勢名・一言」が欠けない（合成画像なら常に OK）
- iOS/Android 両方で共有できる（最低 1 台ずつ）
- 長めの一言でも崩れない（折返し/省略ルール確認）

## 受け入れ条件

- おみくじ結果表示は常に「画像・運勢名・一言」の 3 点セット
- シェア実行で、受け取り側が見たときに 3 点が必ず分かる
- 合成画像方式なら、共有物は 1 枚の画像で完結している
- シェアが失敗する端末/環境でも、最低限テキスト共有にフォールバックする
- 一時ファイルが端末に溜まり続けない

## サブIssue候補

1. データ構造の 3 点セット化（型 + 定数）
2. 7 運勢化 + 一言 5 種 × 7 投入
3. 重み付き抽選の導入
4. 結果画面の参照置換
5. シェア用「合成画像」生成 & 共有
6. シェアの OS 別検証 & フォールバック実装

## シェア方針メモ

シェアは「画像 + 文字を同時に渡す」が OS 差で壊れやすいため、本 Epic では“合成画像を 1 枚作ってそれを共有する”方式を第一候補に置く。これにより「3 つを必ずシェア」が仕様として担保される。OS の制約が強い場合は、画像共有 + テキスト、またはテキストのみのフォールバックを用意する。
