---
id: rr-upstream-create-plan-001
name: 計画作成とレビュー
description: 課題のゴールと制約を整理し、仮説・リスク付きの実行計画を段階的に提示して人間レビューにかける
phase: upstream
applyTo:
  - 'docs/**/*'
  - 'pages/**/*'
  - '**/*.md'
  - '**/*.adr'
tags:
  - planning
  - upstream
severity: major
inputContext:
  - diff
  - repoConfig
outputKind:
  - summary
  - actions
  - questions
modelHint: balanced
---

## Goal / 目的

- 課題のゴールと制約を整理し、実行手順・検証ポイント・リスクを可視化した計画を作る。
- HITL 前提で「確認が必要な仮説」と「すぐ実行できる手順」を分け、再現性のある進め方を示す。

## Non-goals / 扱わないこと

- 実装やリファクタの正解を断定しない（計画を提示し、人間レビューを待つ）。
- 要件が曖昧なままの推測で進めない。情報不足は質問として返す。
- 大規模な設計判断（アーキ変更/技術選定）を独断で決めない。

## False-positive guards / 抑制条件

- 差分がドキュメント修正のみ、または極小変更で計画が不要な場合は `NO_ISSUES`。
- 既に明示的な計画や承認済みの実行手順が差分内にある場合は重複提案を避ける。

## Rule / ルール

1. ゴールと制約の把握
   - 目的、完了条件、スコープ外、期限/リソース制約を 3〜5 行で要約。
2. 不足情報の確認
   - 判断に必要な事実が欠けていれば質問を先出しし、仮説と分けて明記。
3. タスク分解と依存
   - 影響範囲（モジュール/契約/データ）を洗い出し、調査→設計→実装→テストの順でステップ化。
   - 各ステップに前提、成果物（例: ADR、テストケース）、完了条件を付ける。
4. リスクとブレーキポイント
   - 不確実性やリスク（互換性、性能、移行、セキュリティ）を列挙し、検証手段・Fallback を添える。
   - 人間レビューが必要なゲート（例: 設計確認、仕様確認）を明示。
5. 実行順序と優先度
   - 速く学べる順に並べ、クリティカルパスを強調。並列できる作業はまとめて示す。

## Output / 出力

- すべて日本語。`(summary):1:` で要約を 1 行、その後にステップ/リスク/質問を列挙。
- ステップは `Step <n>: <目的> | 前提 | 成果物 | 完了条件` 形式、最大 10 行。
- リスクは `[risk] <内容> / 検証方法 / Fallback` 形式、最大 5 件。
- 質問は `[q] <確認したいこと>` として箇条書き。

## 評価指標（Evaluation）

- 合格: ゴールと制約が整理され、仮説と確定事項を分離し、実行手順に完了条件がある。
- 不合格: 差分と無関係な一般論、根拠のない断定、情報不足を質問にせず進める。

## 人間に返す条件（Human Handoff）

- 仕様・優先度・リスク許容度が不明で判断が割れる場合。
- アーキテクチャ変更や外部依存の選定が絡み、合意形成が必要な場合。
