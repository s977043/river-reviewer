# AIレビュー セキュリティ/データ取り扱い（Static）

## データフローの整理

- **SaaS 版**: PR の差分・メタ情報・必要な周辺文脈がサービス側へ送信され、モデル推論結果がコメントとして返る。
- **OSS 版（Actions）**: PR 差分が GitHub Actions を経由し、指定した LLM プロバイダへ送信される。
  - Azure OpenAI などを使う場合は、データの送信先を社内方針に合わせて固定できる。

## 機密情報の扱い

- **対象外リポジトリ**: 機密区分が高いリポジトリは原則対象外とする。
- **対象外ディレクトリ**: `secrets/`, `keys/`, `vendor/`, `dist/`, `*.lock` などは除外する。
- **シークレット混入時の対応**:
  1. PR を即時停止（pause）
  2. シークレットの撤回/ローテーション
  3. 履歴からの削除と再発防止ルールの追加

## OSS 版利用時の追加注意

- **外部 PR（fork）**は危険度が高い。以下を徹底する。
  - secrets を fork PR に渡さない
  - `pull_request_target` は最小権限かつ条件付きにする
  - fork PR は手動トリガー or レビュー後に実行
- ワークフロー権限は `contents: read` / `pull-requests: write` を基本とし、必要最小限にする。

## 社内ポリシー（テンプレ）

- **許可**
  - 社内コードの一般リポジトリ（機密区分が低いもの）
  - 生成物/個人情報を含まないディレクトリ
- **禁止**
  - 個人情報・顧客情報・規制対象データを含む PR
  - 機密区分が高いリポジトリ
  - fork PR に対する自動実行（OSS 版）

## 期待値調整

- AI レビューは誤検知・見落としがあり得る。セキュリティ判断は人が最終責任を持つ。

## 運用例

- PR にシークレットが含まれていた場合は `@river-review-bot pause` で停止し、
  リポジトリ側の保護ルールと連動して強制レビューへ切り替える。
